id: network.koesling.shm-modbus
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: shm-modbus
finish-args:
  - --device=shm
  - --share=network
modules:
  - name: launch_script
    buildsystem: simple
    build-commands:
      - install -D -m 755 shm-modbus ${FLATPAK_DEST}/bin/shm-modbus
      - install -D -m 644 guided-commands.sh ${FLATPAK_DEST}/bin/guided-commands.sh
      - install -D -m 644 manual-commands.sh ${FLATPAK_DEST}/bin/manual-commands.sh

    sources:
      - type: file
        path: shm-modbus
      - type: file
        path: guided-commands.sh
      - type: file
        path: manual-commands.sh

  - name: Modbus_TCP_client_shm
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCLANG_FORMAT=OFF
      - -DCOMPILER_WARNINGS=OFF

    sources:
      - type: git
        tag: v1.3.1
        commit: 0d4ba00315ac62df9312fa94c2cdd6856c1be6c7
        url: https://github.com/NikolasK-source/modbus_tcp_client_shm.git

  - name: signal_gen
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps .
      - mv /app/bin/signalgen /app/bin/signal-gen
    sources:
      - type: git
        tag: v1.0.0
        commit: 418bcede5f65faf8053cb1f764edf6f1b3b03c32
        url: https://github.com/NikolasK-source/shm-modbus-signal-gen.git

  - name: Modbus_RTU_client_shm
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCLANG_FORMAT=OFF
      - -DCOMPILER_WARNINGS=OFF

    sources:
      - type: git
        tag: v0.2.4
        commit: 43d16619820661f1440285d724887cd1e305e97b
        url: https://github.com/NikolasK-source/modbus_rtu_client_shm.git

  - name: write_shm
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCLANG_FORMAT=OFF
      - -DCOMPILER_WARNINGS=OFF

    sources:
      - type: git
        tag: v0.1.3
        commit: bc58b820a79fd00a699835acbfb23f8870c7a528 
        url: https://github.com/NikolasK-source/write_shm.git

  - name: SHM_random
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCLANG_FORMAT=OFF
      - -DCOMPILER_WARNINGS=OFF

    sources:
      - type: git
        tag: v1.1.0
        commit: c14decab141650555fdaef43269fb202afd9be2d 
        url: https://github.com/NikolasK-source/shared_mem_random.git

  - name: dump_shm
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCLANG_FORMAT=OFF
      - -DCOMPILER_WARNINGS=OFF

    sources:
      - type: git
        tag: v1.1.0
        commit: 3461093c6b35672ba5d5cc90f8cc2527ce3d9471 
        url: https://github.com/NikolasK-source/dump_shm.git

  - name: stdin-to-modbus-shm
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCLANG_FORMAT=OFF
      - -DCOMPILER_WARNINGS=OFF

    sources:
      - type: git
        tag: v1.1.3
        commit: 150198ef75c0fa066eb1e312c29a60744433081d 
        url: https://github.com/NikolasK-source/stdin_to_modbus_shm.git


  - name: metadata
    buildsystem: simple
    build-commands:
      - install -D -m 644 network.koesling.shm-modbus.metainfo.xml "${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml"
      - install -D -m 644 -t "${FLATPAK_DEST}/share/icons/hicolor/scalable/apps" ${FLATPAK_ID}.svg
      - install -D -m 644 ${FLATPAK_ID}_256.png "${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png"
      - install -D -m 644 -t ${FLATPAK_DEST}/share/applications/ ${FLATPAK_ID}.desktop

    sources:
      - type: file
        path: network.koesling.shm-modbus.metainfo.xml
      - type: file
        path: network.koesling.shm-modbus.svg
      - type: file
        path: network.koesling.shm-modbus_256.png
      - type: file
        path: network.koesling.shm-modbus.desktop
